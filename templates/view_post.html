{% extends "base.html" %}

{% block title %}{{ post['title'] }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>{{ post['title'] }}</h1>
    <p>{{ post['description'] }}</p>
    <small class="text-muted">Posted by {{ post['username'] }} on {{ post['created_at'] }}</small>
    
    {% if post['customization_name'] %}
        <p>Customization: {{ post['customization_name'] }} (ID: {{ post['customization_id'] }})</p>
    {% else %}
        <p>Customization: None</p>
    {% endif %}
    
    <hr>
    
    <h4>Comments:</h4>
    {% if comments %}
        <ul class="list-group">
            {% for comment in comments %}
                <li class="list-group-item">
                    <strong>{{ comment['username'] }}:</strong> {{ comment['content'] }} <small class="text-muted">({{ comment['created_at'] }})</small>
                    
                    {% if current_user.is_authenticated and (current_user.id == comment['user_id'] or current_user.admin) %}
                        <div class="mt-2">
                            <a href="{{ url_for('edit_comment', comment_id=comment['comment_id']) }}" class="btn btn-secondary btn-sm">Edit Comment</a>
                            <form method="POST" action="{{ url_for('delete_comment', comment_id=comment['comment_id']) }}" style="display:inline;">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this comment?');">Delete Comment</button>
                            </form>
                        </div>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No comments yet. Be the first to comment!</p>
    {% endif %}
    
    <h4 class="mt-4">Add a Comment:</h4>
    <form method="POST" action="{{ url_for('create_comment', post_id=post['post_id']) }}">
        <textarea name="content" rows="3" required class="form-control"></textarea>
        <button type="submit" class="btn btn-primary mt-2">Add Comment</button>
    </form>
</div>
{% endblock %}
